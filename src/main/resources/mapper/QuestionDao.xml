<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.app.dao.QuestionDao">

    <resultMap type="com.zhiliao.app.entity.Question" id="QuestionMap">
        <result property="qs_id" column="qs_id" jdbcType="INTEGER"/>
        <result property="content" column="content" jdbcType="INTEGER"/>
        <result property="tag" column="tag" jdbcType="INTEGER"/>
        <result property="author" column="author" jdbcType="VARCHAR"/>
        <result property="agreecount" column="agreeCount" jdbcType="INTEGER"/>
        <result property="viewcount" column="viewCount" jdbcType="INTEGER"/>
        <result property="collectcount" column="collectCount" jdbcType="INTEGER"/>
        <result property="deleted" column="deleted" jdbcType="INTEGER"/>
        <result property="createtime" column="createtime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!--查询单个-->
    <select id="queryById" resultMap="QuestionMap">
        select
          id, use_id, uid, content, introduction, tag, agreeCount, comment, answer, follower, viewCount, collectCount, createDate
        from question
        where id = #{id}
    </select>

    <!--查询指定行数据-->
    <select id="queryAllByLimit" resultMap="QuestionMap">
        select
          id, use_id, uid, content, introduction, tag, agreeCount, comment, answer, follower, viewCount, collectCount, createDate
        from question
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <if test="useId != null">
                and use_id = #{useId}
            </if>
            <if test="uid != null">
                and uid = #{uid}
            </if>
            <if test="content != null and content != ''">
                and content = #{content}
            </if>
            <if test="introduction != null and introduction != ''">
                and introduction = #{introduction}
            </if>
            <if test="tag != null and tag != ''">
                and tag = #{tag}
            </if>
            <if test="agreecount != null">
                and agreeCount = #{agreecount}
            </if>
            <if test="comment != null and comment != ''">
                and comment = #{comment}
            </if>
            <if test="answer != null and answer != ''">
                and answer = #{answer}
            </if>
            <if test="follower != null and follower != ''">
                and follower = #{follower}
            </if>
            <if test="viewcount != null">
                and viewCount = #{viewcount}
            </if>
            <if test="collectcount != null">
                and collectCount = #{collectcount}
            </if>
            <if test="createdate != null">
                and createDate = #{createdate}
            </if>
        </where>
        limit #{pageable.offset}, #{pageable.pageSize}
    </select>

    <!--统计总行数-->
    <select id="count" resultType="java.lang.Long">
        select count(1)
        from question
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <if test="useId != null">
                and use_id = #{useId}
            </if>
            <if test="uid != null">
                and uid = #{uid}
            </if>
            <if test="content != null and content != ''">
                and content = #{content}
            </if>
            <if test="introduction != null and introduction != ''">
                and introduction = #{introduction}
            </if>
            <if test="tag != null and tag != ''">
                and tag = #{tag}
            </if>
            <if test="agreecount != null">
                and agreeCount = #{agreecount}
            </if>
            <if test="comment != null and comment != ''">
                and comment = #{comment}
            </if>
            <if test="answer != null and answer != ''">
                and answer = #{answer}
            </if>
            <if test="follower != null and follower != ''">
                and follower = #{follower}
            </if>
            <if test="viewcount != null">
                and viewCount = #{viewcount}
            </if>
            <if test="collectcount != null">
                and collectCount = #{collectcount}
            </if>
            <if test="createdate != null">
                and createDate = #{createdate}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into question(use_id, uid, content, introduction, tag, agreeCount, comment, answer, follower, viewCount, collectCount, createDate)
        values (#{useId}, #{uid}, #{content}, #{introduction}, #{tag}, #{agreecount}, #{comment}, #{answer}, #{follower}, #{viewcount}, #{collectcount}, #{createdate})
    </insert>

    <insert id="insertBatch" keyProperty="id" useGeneratedKeys="true">
        insert into question(use_id, uid, content, introduction, tag, agreeCount, comment, answer, follower, viewCount, collectCount, createDate)
        values
        <foreach collection="entities" item="entity" separator=",">
        (#{entity.useId}, #{entity.uid}, #{entity.content}, #{entity.introduction}, #{entity.tag}, #{entity.agreecount}, #{entity.comment}, #{entity.answer}, #{entity.follower}, #{entity.viewcount}, #{entity.collectcount}, #{entity.createdate})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="id" useGeneratedKeys="true">
        insert into question(use_id, uid, content, introduction, tag, agreeCount, comment, answer, follower, viewCount, collectCount, createDate)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.useId}, #{entity.uid}, #{entity.content}, #{entity.introduction}, #{entity.tag}, #{entity.agreecount}, #{entity.comment}, #{entity.answer}, #{entity.follower}, #{entity.viewcount}, #{entity.collectcount}, #{entity.createdate})
        </foreach>
        on duplicate key update
        use_id = values(use_id),
        uid = values(uid),
        content = values(content),
        introduction = values(introduction),
        tag = values(tag),
        agreeCount = values(agreeCount),
        comment = values(comment),
        answer = values(answer),
        follower = values(follower),
        viewCount = values(viewCount),
        collectCount = values(collectCount),
        createDate = values(createDate)
    </insert>

    <insert id="add_question">
        insert into question(qs_id, content, tag, createtime,author)
        values
            (#{question.qs_id}, #{question.content}, #{question.tag}, now(), #{author})
    </insert>
    <insert id="collect_question">
        insert into collect_question(id,qs_id)
        values (#{id},#{qs_id})
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update question
        <set>
            <if test="useId != null">
                use_id = #{useId},
            </if>
            <if test="uid != null">
                uid = #{uid},
            </if>
            <if test="content != null and content != ''">
                content = #{content},
            </if>
            <if test="introduction != null and introduction != ''">
                introduction = #{introduction},
            </if>
            <if test="tag != null and tag != ''">
                tag = #{tag},
            </if>
            <if test="agreecount != null">
                agreeCount = #{agreecount},
            </if>
            <if test="comment != null and comment != ''">
                comment = #{comment},
            </if>
            <if test="answer != null and answer != ''">
                answer = #{answer},
            </if>
            <if test="follower != null and follower != ''">
                follower = #{follower},
            </if>
            <if test="viewcount != null">
                viewCount = #{viewcount},
            </if>
            <if test="collectcount != null">
                collectCount = #{collectcount},
            </if>
            <if test="createdate != null">
                createDate = #{createdate},
            </if>
        </set>
        where id = #{id}
    </update>
    <update id="remove_question">
        update question set deleted=1 where qs_id=#{qs_id}
    </update>
    <update id="remove_collect_question">
        update collect_question set deleted=1
           where id=#{id} and qs_id=#{qs_id}
    </update>
    <update id="like_question">
        update question set agreecount = agreecount+1
          where qs_id=#{qs_id}
    </update>
    <!--通过主键删除-->
    <delete id="deleteById">
        delete from question where id = #{id}
    </delete>

</mapper>

